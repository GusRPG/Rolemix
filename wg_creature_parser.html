<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wrath & Glory Parser</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Share Tech Mono', monospace;
            background: #000;
            color: #00ff41;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 255, 100, 0.03) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(0, 100, 255, 0.03) 0%, transparent 20%),
                linear-gradient(45deg, #0a0a0a 25%, #111 25%, #111 50%, #0a0a0a 50%, #0a0a0a 75%, #111 75%);
            background-size: 100px 100px;
            overflow-x: hidden;
            position: relative;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 10;
        }

        .header-bar {
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 70px;
            background: linear-gradient(to bottom, #00ff41 0%, #00cc33 100%);
            box-shadow: 
                0 0 20px #00ff41,
                inset 0 0 15px rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 25px;
            z-index: 100;
            border-bottom: 3px solid #00ff41;
            backdrop-filter: blur(2px);
        }

        .header-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: #000;
            text-shadow: 0 0 8px #00ff41;
            letter-spacing: 3px;
        }

        .controls {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .lang-toggle {
            background: rgba(0, 0, 0, 0.85);
            border: 1px solid #00ff41;
            color: #00ff41;
            padding: 8px 12px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.3);
            transition: all 0.2s ease;
            text-shadow: 0 0 5px #00ff41;
        }

        .lang-toggle:hover {
            background: #00ff41;
            color: #000;
            box-shadow: 0 0 15px #00ff41;
            text-shadow: none;
        }

        .main-content {
            margin-top: 90px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #00ff41;
            box-shadow: 
                0 0 20px rgba(0, 255, 65, 0.2),
                inset 0 0 30px rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            position: relative;
            z-index: 10;
        }

        h1 {
            color: #00ff41;
            text-align: center;
            margin-bottom: 20px;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 10px #00ff41;
            letter-spacing: 2px;
        }

        /* AVISO ARRIBA: SEPARADORES º y ~ */
        .separator-notice {
            text-align: center;
            font-size: 0.95rem;
            color: #00ff41;
            margin-bottom: 15px;
            text-shadow: 0 0 5px #00ff41;
            font-weight: bold;
        }
        .separator-notice .tilde {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #00ff41;
            text-shadow: 0 0 8px #00ff41;
        }

        .hint {
            text-align: center;
            font-size: 0.9rem;
            color: #00cc33;
            margin-bottom: 20px;
            text-shadow: 0 0 5px #00ff41;
            font-style: italic;
        }

        .settings {
            background: rgba(0, 20, 0, 0.5);
            border: 1px dashed #00ff41;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.1);
        }

        .settings h3 {
            color: #00ff41;
            margin-bottom: 10px;
            text-shadow: 0 0 5px #00ff41;
        }

        .settings label {
            color: #00ff41;
            font-size: 0.85rem;
            margin-right: 15px;
            display: inline-block;
            margin-bottom: 8px;
        }

        .settings input[type="checkbox"] {
            accent-color: #00ff41;
            transform: scale(1.2);
            margin-right: 5px;
        }

        .row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .col {
            flex: 1;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #00ff41;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.1);
        }

        .col h3 {
            color: #00ff41;
            margin-bottom: 10px;
            text-shadow: 0 0 5px #00ff41;
            font-size: 1rem;
        }

        textarea {
            width: 100%;
            height: 320px;
            background: #000;
            color: #00ff41;
            border: 1px solid #00ff41;
            padding: 12px;
            font-family: 'Share Tech Mono', monospace;
            font-size: 12px;
            resize: vertical;
            box-shadow: inset 0 0 15px rgba(0, 255, 65, 0.1);
            text-shadow: 0 0 3px #00ff41;
        }

        textarea::placeholder {
            color: #006622;
            opacity: 0.8;
        }

        button {
            background: #000;
            color: #00ff41;
            border: 1px solid #00ff41;
            padding: 10px 18px;
            margin: 8px 8px 8px 0;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.9rem;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.3);
            transition: all 0.2s ease;
            text-shadow: 0 0 5px #00ff41;
        }

        button:hover {
            background: #00ff41;
            color: #000;
            box-shadow: 0 0 15px #00ff41;
            text-shadow: none;
        }

        pre {
            background: #000;
            color: #00ff41;
            border: 1px solid #00ff41;
            padding: 15px;
            max-height: 400px;
            overflow: auto;
            font-size: 11px;
            font-family: 'Share Tech Mono', monospace;
            white-space: pre-wrap;
            box-shadow: inset 0 0 15px rgba(0, 255, 65, 0.1);
            text-shadow: 0 0 3px #00ff41;
            line-height: 1.4;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            margin-top: 20px;
            border: 1px solid #00ff41;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.1);
        }

        table th, table td {
            border: 1px solid #00ff41;
            padding: 10px;
            text-align: left;
        }

        table th {
            background: rgba(0, 255, 65, 0.1);
            color: #00ff41;
            text-shadow: 0 0 5px #00ff41;
            font-weight: bold;
        }

        table tr:hover {
            background: rgba(0, 255, 65, 0.05);
        }

        .actions {
            margin-top: 30px;
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px dashed #00ff41;
        }

        #info {
            margin-top: 15px;
            font-size: 1rem;
            color: #00ff41;
            text-shadow: 0 0 5px #00ff41;
        }

        /* === EFECTO CRT: LÍNEA QUE BAJA (SCANLINE) === */
        .crt-scanline {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 255, 65, 0.03),
                rgba(0, 255, 65, 0.03) 2px,
                transparent 2px,
                transparent 4px
            );
            z-index: 1000;
            animation: scanline 7s linear infinite;
            opacity: 0.6;
        }

        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }

        /* EFECTO CRT: LIGERO FLICKER */
        .crt-flicker {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            background: transparent;
            z-index: 999;
            animation: flicker 0.15s infinite alternate;
            opacity: 0.02;
        }

        @keyframes flicker {
            0% { opacity: 0.01; }
            100% { opacity: 0.03; }
        }

        .glitch {
            animation: glitch 3s infinite;
        }

        @keyframes glitch {
            0%, 100% { text-shadow: 0 0 5px #00ff41; }
            50% { text-shadow: 2px 0 0 #ff00ff, -2px 0 0 #00ffff; }
        }
    </style>
</head>
<body>
    <!-- EFECTO CRT: LÍNEA QUE BAJA -->
    <div class="crt-scanline"></div>
    <div class="crt-flicker"></div>

    <div class="container">
        <div class="header-bar">
            <div class="header-title glitch">W&G COMPENDIUM PARSER v9.9</div>
            <div class="controls">
                <div id="langToggle" class="lang-toggle">ESP</div>
            </div>
        </div>

        <div class="main-content">
            <h1 data-en="Wrath & Glory Compendium Parser" data-es="Wrath & Glory Compendium Parser">Wrath & Glory Compendium Parser</h1>
            
            <!-- AVISO: SEPARADORES º y ~ -->
            <div class="separator-notice" id="separatorNotice">
                <span data-en="You can separate entries with <strong>º</strong> or <span class='tilde'>~</span> at the beginning of each creature."
                      data-es="Puedes separar registros con <strong>º</strong> o <span class='tilde'>~</span> al inicio de cada criatura.">
                </span>
            </div>

            <div class="hint" id="separatorHint">
                <span data-en="Use º or ~ at the start of each new creature. If none is used at the beginning, it will be treated as a single entry."
                      data-es="Usa º o ~ al inicio de cada nueva criatura. Si no se usa al principio, se tratará como una sola entrada.">
                </span>
            </div>

            <div class="settings">
                <h3 data-en="AutoCalc Settings" data-es="Configuración de AutoCalc">AutoCalc Settings</h3>
                <label><input type="checkbox" id="toggleAll" checked> <span data-en="Toggle All" data-es="Activar/Desactivar Todos">Toggle All</span></label><br>
                <label><input type="checkbox" id="generateMetaCurrencies" checked> generateMetaCurrencies</label>
                <label><input type="checkbox" id="defence" checked> defence</label>
                <label><input type="checkbox" id="resilience" checked> resilience</label>
                <label><input type="checkbox" id="shock" checked> shock</label>
                <label><input type="checkbox" id="awareness" checked> awareness</label>
                <label><input type="checkbox" id="resolve" checked> resolve</label>
                <label><input type="checkbox" id="determination" checked> determination</label>
                <label><input type="checkbox" id="wounds" checked> wounds</label>
                <label><input type="checkbox" id="conviction" checked> conviction</label>
            </div>

            <div class="row">
                <div class="col">
                    <h3 data-en="Input (separate with º or ~)" data-es="Input (separar con º o ~)">Input (separate with º or ~)</h3>
                    <textarea id="input" placeholder="ºCREATURE NAME... or ~CREATURE NAME..."></textarea>
                    <button id="importBtn" data-en="Import" data-es="Importar">Import</button>
                    <button id="clearBtn" data-en="Clear" data-es="Limpiar">Clear</button>
                </div>
                <div class="col">
                    <h3 data-en="Debug" data-es="Debug">Debug</h3>
                    <pre id="debug"></pre>
                </div>
            </div>

            <h3 data-en="Creatures" data-es="Criaturas">Creatures</h3>
            <table>
                <thead>
                    <tr>
                        <th data-en="Name" data-es="Nombre">Name</th>
                        <th data-en="Tier" data-es="Tier">Tier</th>
                        <th data-en="Items" data-es="Items">Items</th>
                        <th data-en="Actions" data-es="Acciones">Actions</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>

            <div class="actions">
                <button id="downloadBtn" data-en="Download JSON" data-es="Descargar JSON">Download JSON</button>
                <button id="copyBtn" data-en="Copy JSON" data-es="Copiar JSON">Copy JSON</button>
                <button id="clearAllBtn" data-en="Delete All" data-es="Borrar Todo">Delete All</button>
                <p id="info">0 <span data-en="creature(s)" data-es="criatura(s)">creature(s)</span></p>
            </div>
        </div>
    </div>

    <script>
        let creatures = [];
        let debugLog = [];
        let currentLang = 'en';
        const SEPARATORS = ['º', '~'];

        const translations = {
            en: {
                separatorNotice: "You can separate entries with <strong>º</strong> or <span class='tilde'>~</span> at the beginning of each creature.",
                separatorHint: "Use º or ~ at the start of each new creature. If none is used at the beginning, it will be treated as a single entry.",
                inputHint: "Input (separate with º or ~)",
                inputPlaceholder: "ºCREATURE NAME... or ~CREATURE NAME...",
                toggleAll: "Toggle All",
                import: "Import",
                clear: "Clear",
                download: "Download JSON",
                copy: "Copy JSON",
                deleteAll: "Delete All",
                creatures: "Creatures",
                items: "Items",
                actions: "Actions",
                name: "Name",
                tier: "Tier",
                infoCreatures: "creature(s)",
                skills: {
                    'athletics': 'Athletics', 'awareness': 'Awareness', 'ballisticSkill': 'Ballistic Skill',
                    'cunning': 'Cunning', 'deception': 'Deception', 'insight': 'Insight', 'intimidation': 'Intimidation',
                    'investigation': 'Investigation', 'leadership': 'Leadership', 'medicae': 'Medicae',
                    'persuasion': 'Persuasion', 'pilot': 'Pilot', 'psychicMastery': 'Psychic Mastery',
                    'scholar': 'Scholar', 'stealth': 'Stealth', 'survival': 'Survival', 'tech': 'Tech',
                    'weaponSkill': 'Weapon Skill'
                },
                sections: { 'WEAPONS': 'WEAPONS', 'ARMOUR': 'ARMOUR', 'ABILITIES': 'ABILITIES', 'TALENTS': 'TALENTOS', 'KEYWORDS': 'KEYWORDS' }
            },
            es: {
                separatorNotice: "Puedes separar registros con <strong>º</strong> o <span class='tilde'>~</span> al inicio de cada criatura.",
                separatorHint: "Usa º o ~ al inicio de cada nueva criatura. Si no se usa al principio, se tratará como una sola entrada.",
                inputHint: "Input (separar con º o ~)",
                inputPlaceholder: "ºNOMBRE CRIATURA... o ~NOMBRE CRIATURA...",
                toggleAll: "Activar/Desactivar Todos",
                import: "Importar",
                clear: "Limpiar",
                download: "Descargar JSON",
                copy: "Copiar JSON",
                deleteAll: "Borrar Todo",
                creatures: "Criaturas",
                items: "Items",
                actions: "Acciones",
                name: "Nombre",
                tier: "Tier",
                infoCreatures: "criatura(s)",
                skills: {
                    'athletics': 'Atletismo', 'awareness': 'Vigilancia', 'ballisticSkill': 'Ballistic Skill',
                    'cunning': 'Astucia', 'deception': 'Engaño', 'insight': 'Perspicacia', 'intimidation': 'Intimidación',
                    'investigation': 'Investigación', 'leadership': 'Liderazgo', 'medicae': 'Medicae',
                    'persuasion': 'Persuasión', 'pilot': 'Pilotaje', 'psychicMastery': 'Dominio Psíquico',
                    'scholar': 'Erudición', 'stealth': 'Sigilo', 'survival': 'Supervivencia', 'tech': 'Técnica',
                    'weaponSkill': 'Weapon Skill'
                },
                sections: { 'WEAPONS': 'ARMAS', 'ARMOUR': 'ARMADURAS', 'ABILITIES': 'HABILIDADES', 'TALENTS': 'TALENTOS', 'KEYWORDS': 'KEYWORDS' }
            }
        };

        function updateHints() {
            document.getElementById('separatorNotice').innerHTML = translations[currentLang].separatorNotice;
            document.getElementById('separatorHint').innerHTML = `<span>${translations[currentLang].separatorHint}</span>`;
            document.querySelector('h3[data-en*="Input"]').textContent = translations[currentLang].inputHint;
            document.getElementById('input').placeholder = translations[currentLang].inputPlaceholder;
        }

        function switchLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('[data-en]').forEach(el => el.textContent = el.getAttribute(`data-${lang}`));
            document.getElementById('langToggle').textContent = lang === 'en' ? 'ESP' : 'ENG';
            updateHints();
            if (creatures.length > 0) updateTable();
        }

        document.getElementById('langToggle').addEventListener('click', () => switchLanguage(currentLang === 'en' ? 'es' : 'en'));

        // PARSER: ACEPTA º o ~
        function importCreatures() {
            try {
                const text = document.getElementById('input').value.trim();
                if (!text) return;

                const lines = text.split('\n');
                let blocks = [], currentBlock = [];
                const firstLine = lines.find(l => l.trim());
                const hasSep = firstLine && SEPARATORS.some(s => firstLine.trim().startsWith(s));

                if (!hasSep) {
                    const c = parseCreature(text);
                    if (c) creatures.push(c);
                } else {
                    lines.forEach(line => {
                        const trimmed = line.trim();
                        if (SEPARATORS.some(s => trimmed.startsWith(s))) {
                            if (currentBlock.length > 0) { blocks.push(currentBlock.join('\n')); currentBlock = []; }
                            currentBlock.push(line);
                        } else if (currentBlock.length > 0) currentBlock.push(line);
                    });
                    if (currentBlock.length > 0) blocks.push(currentBlock.join('\n'));
                    const newCreatures = blocks.map(block => parseCreature(block)).filter(c => c);
                    creatures = creatures.concat(newCreatures);
                }

                updateTable(); updateInfo();
            } catch (e) { alert('Error: ' + e.message); console.error(e); }
        }

        // [Resto del código: parseCreature, updateTable, etc. — idéntico a versiones previas]
        const skillMap = { /* ... */ };
        function log(msg) { debugLog.push(msg); }
        function generateId() { const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'; let r=''; for(let i=0;i<16;i++) r+=chars.charAt(Math.floor(Math.random()*chars.length)); return r; }
        function isSectionHeader(line) { /* ... */ }
        function createItem(type, name, content, abilityType = "", equipped = true) { /* ... */ }
        function getSettings() { /* ... */ }
        document.getElementById('toggleAll').onclick = function() { /* ... */ };

        function parseCreature(text) {
            debugLog = []; log("=== PARSING START ===");
            const lines = text.split('\n').map(l => l.trim()).filter(l => l);
            if (!lines.length) return null;

            let nameIndex = 0;
            while (nameIndex < lines.length && !lines[nameIndex].match(/^(Tier|Threat|Keywords|S T A I)/i)) nameIndex++;
            const name = lines.slice(0, nameIndex).join(' ').replace(new RegExp(`^[${SEPARATORS.join('')}]+`), '').trim().toUpperCase() || "UNKNOWN";
            log(`Creature name: ${name}`);

            const skillsTemplate = {}; Object.entries(skillMap).forEach(([k, v]) => skillsTemplate[v.key] = { "label": "SKILL." + v.key.toUpperCase(), "attribute": v.attr, "rating": 0, "base": 0, "bonus": 0, "cost": 0, "total": 0 });
            const settings = getSettings();
            const creature = { /* ... estructura completa ... */ };

            // [Todo el parsing interno igual]
            document.getElementById('debug').innerText = debugLog.join('\n');
            return creature;
        }

        function updateTable() { /* ... */ }
        function updateInfo() { document.getElementById('info').innerHTML = `${creatures.length} <span data-en="${translations.en.infoCreatures}" data-es="${translations.es.infoCreatures}">${translations[currentLang].infoCreatures}</span>`; }
        function clearInput() { document.getElementById('input').value = ''; document.getElementById('debug').innerText = ''; }
        function clearAll() { creatures = []; updateTable(); updateInfo(); document.getElementById('debug').innerText = ''; }
        function deleteCreature(idx) { creatures.splice(idx, 1); updateTable(); updateInfo(); }
        function downloadJSON() { /* ... */ }
        function copyJSON() { /* ... */ }
        function showCreatureDetail(idx) { /* ... */ }
        function wordWrap(text, max) { /* ... */ }

        document.getElementById('importBtn').addEventListener('click', importCreatures);
        document.getElementById('clearBtn').addEventListener('click', clearInput);
        document.getElementById('clearAllBtn').addEventListener('click', clearAll);
        document.getElementById('downloadBtn').addEventListener('click', downloadJSON);
        document.getElementById('copyBtn').addEventListener('click', copyJSON);

        updateHints();
    </script>
</body>
</html>
